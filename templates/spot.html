{% extends "base.html" %}

{% block title %}Spot Registration - YUKTI 2025{% endblock %}

{% block content %}
<!-- Add top divider -->
<div class="h-0.5 bg-gradient-to-r from-[#6D28D9] via-[#3B82F6] to-[#00FFFF]"></div>

<div class="min-h-screen bg-gradient-to-br from-[#1C1C1C] to-[#0A0A0A] py-12 px-4">
    <div class="max-w-4xl mx-auto mt-20">
        <!-- Title -->
        <h1 class="text-4xl font-bold text-[#00FFFF] text-center mb-8 font-['Orbitron']">
            YUKTI-2025 Spot Registration
        </h1>

        <!-- Registration Form Container -->
        <div class="bg-[rgba(46,46,46,0.8)] backdrop-blur-md p-8 rounded-xl border-2 border-[#00FFFF] 
                    shadow-[0_0_15px_rgba(0,255,255,0.3)]">
            
            <form id="registrationForm" onsubmit="event.preventDefault(); submitRegistration();" class="space-y-8">
                <!-- Event Selection Section -->
                <div class="space-y-6">
                    <!-- Category Selection -->
                    <div class="form-group">
                        <label class="block text-[#00FFFF] mb-2 font-['Orbitron']" for="category">
                            Select Event Category
                        </label>
                        <select id="category" required 
                                class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                       outline-none transition-all duration-300 focus:border-[#FF00FF]
                                       focus:shadow-[0_0_15px_rgba(255,0,255,0.3)]">
                            <option value="" disabled selected>--Select--</option>
                            <option value="tech">Manthana (Tech Events)</option>
                            <option value="Cultural">Manoranjana (Cultural Events)</option>
                            <option value="management">Chintana (Management Events)</option>
                            <option value="VisualArt">Kalachitrana (VisualArt)</option>
                            <option value="games">Krida Ratna(Game Events)</option>
                        </select>
                    </div>

                    <!-- Events Container -->
                    <div class="form-group">
                        <label class="block text-[#00FFFF] mb-2 font-['Orbitron']">Select an Event</label>
                        <div id="events-container" class="space-y-2 text-[#C0C0C0]">
                            <p>Please select a category first.</p>
                        </div>
                    </div>

                    <!-- Group Size Container -->
                    <div id="group-size-container" class="hidden space-y-2">
                        <label for="group-size" class="block text-xl font-bold text-[#00FFFF] mb-2">Number of Participants</label>
                        <div class="flex items-center space-x-4">
                            <button type="button" id="decrease-size" 
                                    class="w-12 h-12 rounded-full bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] text-[#00FFFF] 
                                           text-2xl font-bold flex items-center justify-center
                                           transition-all duration-300 hover:bg-[#00FFFF] hover:text-black
                                           disabled:opacity-50 disabled:cursor-not-allowed">
                                -
                            </button>
                            <input type="number" id="group-size" min="1" max="10" value="1" readonly
                                   class="w-20 p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                          outline-none text-center text-xl font-bold">
                            <button type="button" id="increase-size"
                                    class="w-12 h-12 rounded-full bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] text-[#00FFFF]
                                           text-2xl font-bold flex items-center justify-center
                                           transition-all duration-300 hover:bg-[#00FFFF] hover:text-black
                                           disabled:opacity-50 disabled:cursor-not-allowed">
                                +
                            </button>
                        </div>
                        <div id="group-size-error" class="text-red-500 text-sm hidden"></div>
                    </div>

                    <!-- Individual Participant Container -->
                    <div id="individual-participant-container" class="hidden">
                        <label class="block text-[#00FFFF] mb-2 font-['Orbitron']" for="individual-participant">
                            Participant Name
                        </label>
                        <input type="text" id="individual-participant" 
                               class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                      outline-none transition-all duration-300 focus:border-[#FF00FF]
                                      focus:shadow-[0_0_15px_rgba(255,0,255,0.3)]"
                               placeholder="Enter Your Name">
                    </div>

                    <!-- Team Members Container -->
                    <div id="team-members-container" class="hidden space-y-4">
                        <label class="block text-[#00FFFF] mb-2 font-['Orbitron']">Team Members</label>
                        <div id="member-inputs" class="space-y-3">
                            <!-- Member inputs will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Add Event Button -->
                    <button type="button" id="add-event-btn" disabled
                            class="w-full bg-[#FF00FF] text-white px-6 py-3 rounded-lg font-bold
                                   transition-all duration-300 hover:bg-transparent hover:text-[#FF00FF] 
                                   hover:border-2 hover:border-[#FF00FF] disabled:opacity-50 
                                   disabled:cursor-not-allowed">
                        + Add Event
                    </button>
                </div>

                <!-- Selected Events Section -->
                <div class="selected-events-section hidden">
                    <h3 class="text-2xl font-bold text-[#00FFFF] mb-4 font-['Orbitron']">Selected Events</h3>
                    <div id="selected-events-list" class="space-y-3">
                        <!-- Selected events will be displayed here -->
                    </div>
                </div>

                <!-- Personal Details Section -->
                <div class="personal-details-section hidden space-y-6">
                  
                    <div class="form-group">
                        <label class="block text-[#00FFFF] mb-2 font-['Orbitron']" for="college">College Name</label>
                        <input type="text" id="college" required 
                               class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                      outline-none transition-all duration-300 focus:border-[#FF00FF]
                                      focus:shadow-[0_0_15px_rgba(255,0,255,0.3)]"
                               placeholder="Enter your college name">
                    </div>

                    <div class="form-group">
                        <label class="block text-[#00FFFF] mb-2 font-['Orbitron']" for="email">Email</label>
                        <input type="email" id="email" required 
                               class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                      outline-none transition-all duration-300 focus:border-[#FF00FF]
                                      focus:shadow-[0_0_15px_rgba(255,0,255,0.3)]"
                               placeholder="Enter your email">
                    </div>

                    <div class="form-group">
                        <label class="block text-[#00FFFF] mb-2 font-['Orbitron']" for="phone">Phone (WhatsApp)</label>
                        <input type="tel" id="phone" required 
                               class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                      outline-none transition-all duration-300 focus:border-[#FF00FF]
                                      focus:shadow-[0_0_15px_rgba(255,0,255,0.3)]"
                               placeholder="Enter your WhatsApp number">
                    </div>

                    <!-- Overall Participants -->
                    <div class="bg-[rgba(32,34,39,0.8)] p-4 rounded-lg border border-[#00FFFF]">
                        <p class="text-[#00FFFF] font-['Orbitron']">
                            Overall Total Participants: <span id="overallParticipants" class="text-white">0</span>
                        </p>
                    </div>

                    <!-- UTR Number -->
                    <div class="form-group">
                        <label class="block text-[#00FFFF] mb-2 font-['Orbitron']" for="utr-number">UTR Number</label>
                        <input type="text" id="utr-number" required 
                               class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                      outline-none transition-all duration-300 focus:border-[#FF00FF]
                                      focus:shadow-[0_0_15px_rgba(255,0,255,0.3)]"
                               placeholder="Enter UTR/Transaction Number">
                        <p class="mt-2 text-sm text-[#C0C0C0]">Enter the UTR number from your payment transaction</p>
                    </div>

                    <!-- Cost Display -->
                    <div class="text-center p-4 bg-[rgba(32,34,39,0.8)] rounded-lg border border-[#00FFFF]">
                        <p class="text-[#C0C0C0] mb-2">*Accommodation is not available.</p>
                        <p class="text-2xl font-bold text-[#00FFFF] font-['Orbitron']"><span class="total-cost">0</span></p>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit"
                            class="w-full bg-[#FF00FF] text-white px-6 py-3 rounded-lg font-bold
                                   transition-all duration-300 hover:bg-transparent hover:text-[#FF00FF] 
                                   hover:border-2 hover:border-[#FF00FF]">
                        <div class="button-content flex items-center justify-center gap-2">
                            <span>Register Now</span>
                            <div class="spinner hidden w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                        </div>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add bottom divider -->
<div class="h-0.5 bg-gradient-to-r from-[#6D28D9] via-[#3B82F6] to-[#00FFFF]"></div>

<!-- Keep existing JavaScript -->
<script>
    // Declare selectedEvents globally so that submitRegistration can access it.
    let selectedEvents = [];

    document.addEventListener("DOMContentLoaded", function () {
        const categorySelect = document.getElementById("category");
        const eventsContainer = document.getElementById("events-container");
        const groupSizeContainer = document.getElementById("group-size-container");
        const groupSizeInput = document.getElementById("group-size");
        const teamMembersContainer = document.getElementById("team-members-container");
        const memberInputsContainer = document.getElementById("member-inputs");
        const addEventBtn = document.getElementById("add-event-btn");
        const selectedEventsList = document.getElementById("selected-events-list");
        const selectedEventsSection = document.querySelector(".selected-events-section");
        const personalDetailsSection = document.querySelector(".personal-details-section");
        const groupSizeError = document.getElementById("group-size-error");
        const individualParticipantContainer = document.getElementById("individual-participant-container");
        const individualParticipantInput = document.getElementById("individual-participant");
        const overallParticipantsSpan = document.getElementById("overallParticipants");

        let currentEventSelection = null;

        
        const events = {
            tech: [
                { name: "Prakalpa Prastuthi (Live Project Expo)", type: "team", cost: 200, minTeam: 1, maxTeam: 3 },
                { name: "CHANAKSH (CODING EVENT)", type: "individual", cost: 100 },
                { name: "Robo Samara(Robo War)", type: "team", cost: 300, minTeam: 1, maxTeam: 4},
                { name: "Robo Samara(Robo Race)", type: "team", cost: 300, minTeam: 1, maxTeam: 4},
                { name: "Pragyan(Quiz)", type: "team", cost: 300, minTeam: 1, maxTeam: 4},
                { name: "Vagmita (Elocution)", type: "individual", cost: 200 }
            ],
            VisualArt: [
                
                { name: "Sthala Chitrapatha (Spot Photography)", type: "individual", cost: 150 },
                { name: "Chitragatha (Short Film)", type: "team", cost: 400, minTeam: 1, maxTeam: 4 },
                { name: "RUPEKHA (Sketch Art)", type: "individual", cost: 200 },
                { name: "Hastakala (Painting)", type: "individual", cost: 150 },
                { name: "Swachitra (Selfie Point)", type: "individual", cost: 100 },
            ],
            Cultural: [
                { name: "NINAAD (Singing Solo )", type: "individual", cost: 200 },
                { name: "NINAAD (Singing Group)", type: "team", cost: 200,minTeam:1, maxTeam:10 },
                { name: "Nritya Saadhana (Dance Solo )", type: "individual", cost: 200 },
                { name: "Nritya Saadhana (Dance Group)", type: "team", cost: 200 ,minTeam:4, maxTeam:8},
               
                { name: "Navyataa (Ramp Walk)", type: "individual", cost: 300 },
            ],
            management: [
               
                { name: "DAKSH (THE BEST MANAGER)", type: "individual", cost: 300 },
                { name: "SHRESHTA VITTA (FINANCE) Final", type: "individual", cost: 200 },
                { name: "MANAVA SANSADHAN (HR)", type: "team", cost: 300, minTeam: 1, maxTeam: 4 },
                { name: "Sumedha(Start Up)", type: "individual", cost: 150 },
                { name: "Vipanan(Marketing)", type: "team", cost: 150,minTeam:2 ,maxTeam:2 }
            ],
            games: [
                { name: "BGMI", type: "team", cost: 400, minTeam: 1, maxTeam: 5 },
                { name: "Talaash", type: "team", cost: 300, minTeam: 1, maxTeam: 5 }
            ]
        };

        function updateTotalCost() {
            let totalCost = 0;
            selectedEvents.forEach(event => {
                totalCost += event.cost; // Use the actual event cost instead of COST_PER_EVENT
            });
            document.querySelector('.total-cost').textContent = `Total Cost: ₹${totalCost}`;
        }

        groupSizeInput.addEventListener("change", function() {
            const numberOfMembers = parseInt(this.value);
            generateMemberInputs(numberOfMembers);
        });

        // Modified team member input generator to clamp count between minTeam and maxTeam
        function generateMemberInputs(count) {
            memberInputsContainer.innerHTML = '';
            teamMembersContainer.classList.remove("hidden");

            if (currentEventSelection && currentEventSelection.type === "team") {
                // Clamp count between event.minTeam and event.maxTeam
                count = Math.min(Math.max(parseInt(count), currentEventSelection.minTeam), currentEventSelection.maxTeam);
                groupSizeInput.value = count;
            }

            for (let i = 1; i <= count; i++) {
                const memberDiv = document.createElement("div");
                memberDiv.classList.add("member-input", "flex", "gap-4", "mb-4");
                
                // Name input
                const nameDiv = document.createElement("div");
                nameDiv.className = "w-1/2";
                const nameInput = document.createElement("input");
                nameInput.type = "text";
                nameInput.id = `member-name-${i}`;
                nameInput.name = `member-name-${i}`;
                nameInput.placeholder = `Member ${i} Name`;
                nameInput.className = "w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white \
                                   placeholder:text-gray-400 outline-none transition-all duration-300 \
                                   focus:border-[#FF00FF] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]";
                nameDiv.appendChild(nameInput);
                
                // USN input
                const usnDiv = document.createElement("div");
                usnDiv.className = "w-1/2";
                const usnInput = document.createElement("input");
                usnInput.type = "text";
                usnInput.id = `member-usn-${i}`;
                usnInput.name = `member-usn-${i}`;
                usnInput.placeholder = `Member ${i} USN/College ID`;
                usnInput.className = "w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white \
                                  placeholder:text-gray-400 outline-none transition-all duration-300 \
                                  focus:border-[#FF00FF] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]";
                usnDiv.appendChild(usnInput);
                
                memberDiv.appendChild(nameDiv);
                memberDiv.appendChild(usnDiv);
                memberInputsContainer.appendChild(memberDiv);
            }

            // Add helper text
            const helperText = document.createElement("p");
            helperText.className = "text-sm text-gray-400 mt-2";
            helperText.textContent = "Format: Name (USN/College ID) - Example: John Doe (1KS22CS001)";
            memberInputsContainer.appendChild(helperText);
        }

        // Add this CSS if not already present
        const style = document.createElement('style');
        style.textContent = `
            .error-border {
                border-color: #FF0000 !important;
            }
        `;
        document.head.appendChild(style);

        addEventBtn.addEventListener("click", function() {
            if (currentEventSelection) {
                const eventDetails = {
                    category: categorySelect.value,
                    event: currentEventSelection.name,
                    type: currentEventSelection.type,
                    cost: currentEventSelection.cost
                };

                if (currentEventSelection.type === "team" || currentEventSelection.type === "group") {
                    eventDetails.members = [];
                    const memberDivs = memberInputsContainer.querySelectorAll(".member-input");
                    memberDivs.forEach(div => {
                        const nameInput = div.querySelector('[id^="member-name-"]');
                        const usnInput = div.querySelector('[id^="member-usn-"]');
                        
                        if (nameInput?.value.trim() && usnInput?.value.trim()) {
                            eventDetails.members.push({
                                name: nameInput.value.trim(),
                                usn: usnInput.value.trim()
                            });
                        }
                    });
                } else {
                    // For individual events, record the participant's name
                    const nameInput = document.getElementById('individual-participant');
                    const usnInput = document.getElementById('individual-usn');
                    
                    if (!nameInput?.value.trim() || !usnInput?.value.trim()) {
                        if (nameInput) nameInput.classList.add('error-border');
                        if (usnInput) usnInput.classList.add('error-border');
                        return;
                    }
                    
                    nameInput.classList.remove('error-border');
                    usnInput.classList.remove('error-border');
                    
                    eventDetails.participant = {
                        name: nameInput.value.trim(),
                        usn: usnInput.value.trim()
                    };
                }

                selectedEvents.push(eventDetails);
                updateSelectedEventsList();
                updateTotalCost();
                resetEventSelection();
                selectedEventsSection.classList.remove("hidden");
                personalDetailsSection.classList.remove("hidden");
            }
        });

        function updateSelectedEventsList() {
            selectedEventsList.innerHTML = '';
            selectedEvents.forEach((event, index) => {
                const eventDiv = document.createElement("div");
                eventDiv.classList.add("selected-event");
                
                let membersText = '';
                if (event.members && event.members.length > 0) {
                    membersText = `<br>Members: ${event.members.map(member => `${member.name} (${member.usn})`).join(", ")}`;
                } else if (event.participant) {
                    membersText = `<br>Participant: ${event.participant.name} (${event.participant.usn})`;
                }

                eventDiv.innerHTML = `
                    <span>${event.event} (${event.category})${membersText}</span>
                    <button type="button" onclick="removeEvent(${index})" class="remove-event-btn">✕</button>
                `;
                selectedEventsList.appendChild(eventDiv);
            });
            updateOverallTotalParticipants();
        }

        function resetEventSelection() {
            const radioInputs = document.querySelectorAll('input[name="event"]');
            radioInputs.forEach(input => input.checked = false);
            groupSizeContainer.classList.add("hidden");
            teamMembersContainer.classList.add("hidden");
            individualParticipantContainer.classList.add("hidden");
            currentEventSelection = null;
            addEventBtn.disabled = true;
        }

        window.removeEvent = function(index) {
            selectedEvents.splice(index, 1);
            updateSelectedEventsList();
            updateTotalCost(); // Add this line
            if (selectedEvents.length === 0) {
                selectedEventsSection.classList.add("hidden");
                personalDetailsSection.classList.add("hidden");
            }
        };

        categorySelect.addEventListener("change", function () {
            const selectedCategory = categorySelect.value;
            eventsContainer.innerHTML = '';

            if (selectedCategory && events[selectedCategory]) {
                events[selectedCategory].forEach(event => {
                    let div = document.createElement("div");
                    div.classList.add("event-option");

                    let input = document.createElement("input");
                    input.type = "radio";
                    input.name = "event";
                    input.value = event.name;
                    input.id = event.name.replace(/\s+/g, "-").toLowerCase();

                    let label = document.createElement("label");
                    label.htmlFor = input.id;
                    label.textContent = `${event.name} ${event.type === 'team' ? `(${event.minTeam}-${event.maxTeam} members)` : ''}`;

                    input.addEventListener("change", function () {
                        currentEventSelection = event;
                        addEventBtn.disabled = false;
                        
                        if (event.type === "team") {
                            groupSizeContainer.classList.remove("hidden");
                            teamMembersContainer.classList.remove("hidden");
                            individualParticipantContainer.classList.add("hidden");
                            
                            // Set min and max based on event configuration
                            groupSizeInput.min = event.minTeam;
                            groupSizeInput.max = event.maxTeam;
                            groupSizeInput.value = event.minTeam;
                            
                            // Update label to show allowed team size
                            const sizeLabel = groupSizeContainer.querySelector('label');
                            sizeLabel.innerHTML = `<strong>Number of Participants (${event.minTeam}-${event.maxTeam})</strong>`;
                        } else {
                            groupSizeContainer.classList.add("hidden");
                            teamMembersContainer.classList.add("hidden");
                            individualParticipantContainer.classList.remove("hidden");
                            updateIndividualParticipantContainer(); // Add this line
                        }
                        
                        generateMemberInputs(parseInt(groupSizeInput.value));
                    });

                    div.appendChild(input);
                    div.appendChild(label);
                    eventsContainer.appendChild(div);
                });
            } else {
                eventsContainer.innerHTML = '<p>Please select a category first.</p>';
            }
        });

        // Validate team size when changed
        groupSizeInput.addEventListener("change", function() {
            const value = parseInt(this.value);
            const min = parseInt(this.min);
            const max = parseInt(this.max);

            if (value < min) {
                this.value = min;
            } else if (value > max) {
                this.value = max;
            }

            generateMemberInputs(parseInt(this.value));
        });

        // Modified event radio button change handler
        eventsContainer.addEventListener("change", function(e) {
            if (e.target.type === "radio") {
                const selectedEvent = events[categorySelect.value].find(event => event.name === e.target.value);
                if (selectedEvent) {
                    currentEventSelection = selectedEvent;
                    addEventBtn.disabled = false;

                    if (selectedEvent.type === "team") {
                        // Show containers
                        groupSizeContainer.classList.remove("hidden");
                        teamMembersContainer.classList.remove("hidden");
                        individualParticipantContainer.classList.add("hidden");
                        
                        // Initialize size input
                        groupSizeInput.value = selectedEvent.minTeam;
                        groupSizeInput.min = selectedEvent.minTeam;
                        groupSizeInput.max = selectedEvent.maxTeam;
                        
                        // Initialize buttons
                        const decreaseBtn = document.getElementById("decrease-size");
                        const increaseBtn = document.getElementById("increase-size");
                        
                        // Set initial button states
                        decreaseBtn.disabled = true; // Initially disabled at min
                        increaseBtn.disabled = selectedEvent.minTeam >= selectedEvent.maxTeam;
                        
                        // Update label
                        const sizeLabel = groupSizeContainer.querySelector('label');
                        sizeLabel.innerHTML = `<strong>Number of Participants (${selectedEvent.minTeam}-${selectedEvent.maxTeam})</strong>`;
                        
                        // Add click handlers
                        decreaseBtn.onclick = () => {
                            let value = parseInt(groupSizeInput.value);
                            if (value > selectedEvent.minTeam) {
                                value--;
                                groupSizeInput.value = value;
                                decreaseBtn.disabled = value <= selectedEvent.minTeam;
                                increaseBtn.disabled = false;
                                generateMemberInputs(value);
                            }
                        };
                        
                        increaseBtn.onclick = () => {
                            let value = parseInt(groupSizeInput.value);
                            if (value < selectedEvent.maxTeam) {
                                value++;
                                groupSizeInput.value = value;
                                increaseBtn.disabled = value >= selectedEvent.maxTeam;
                                decreaseBtn.disabled = false;
                                generateMemberInputs(value);
                            }
                        };
                        
                        generateMemberInputs(selectedEvent.minTeam);
                    } else {
                        // For individual events, hide team inputs and show participant field
                        groupSizeContainer.classList.add("hidden");
                        teamMembersContainer.classList.add("hidden");
                        individualParticipantContainer.classList.remove("hidden");
                        updateIndividualParticipantContainer(); // Add this line
                    }
                }
            }
        });

        // Group size input validation
        groupSizeInput.addEventListener("input", function() {
            if (!currentEventSelection) return;
            
            let value = parseInt(this.value) || 0;
            const min = currentEventSelection.minTeam || 1;
            const max = currentEventSelection.maxTeam || 1;
            
            if (value < min) value = min;
            if (value > max) value = max;
            
            this.value = value;
            generateMemberInputs(value);
        });

        // Restrict groupSizeInput value on user input
        groupSizeInput.addEventListener("input", function() {
            if (!currentEventSelection || currentEventSelection.type !== "team") return;
            
            let value = parseInt(this.value) || currentEventSelection.minTeam;
            const min = currentEventSelection.minTeam;
            const max = currentEventSelection.maxTeam;
            
            if (value < min || value > max) {
                groupSizeError.textContent = `Please enter a value between ${min} and ${max}.`;
                groupSizeError.classList.remove("hidden");
                addEventBtn.disabled = true;
            } else {
                groupSizeError.textContent = "";
                groupSizeError.classList.add("hidden");
                addEventBtn.disabled = false;
                this.value = value;
                generateMemberInputs(value);
            }
        });

        // Add new styles for event options
        const additionalStyles = `
            .event-option {
                border: 2px solid #03e9f4;
                transition: all 0.3s ease;
                background: rgba(3, 233, 244, 0.05);
            }

            .event-option:hover {
                transform: translateX(10px);
                box-shadow: 0 0 15px rgba(3, 233, 244, 0.5);
                background: rgba(3, 233, 244, 0.1);
            }

            .event-option input[type="radio"]:checked + label {
                color: #03e9f4;
                text-shadow: 0 0 5px #03e9f4;
            }
        `;

        // Insert the new styles
        const styleSheet = document.createElement("style");
        styleSheet.innerText = additionalStyles;
        document.head.appendChild(styleSheet);

        function updateTotalParticipants() {
            // Start with 0 instead of counting a leader by default.
            const leaderCount = 0;
            const memberInputs = memberInputsContainer.querySelectorAll("input[name^='member-']");
            console.log("Current team members count:", memberInputs.length);
        }
        
        function updateOverallTotalParticipants() {
            let overall = 0;
            selectedEvents.forEach(ev => {
                if (ev.type === "team" || ev.type === "group") {
                    overall += ev.members.length;
                } else {
                    overall += 1;
                }
            });
            overallParticipantsSpan.textContent = overall;
        }

        // Call updateTotalParticipants when any team member input changes
        memberInputsContainer.addEventListener("input", updateTotalParticipants);
        
        // Ensure update after adding a new team select (if applicable)
        document.getElementById("group-size").addEventListener("change", function(){
            generateMemberInputs(parseInt(this.value));
        });
        
        // Initial update now shows 0.
        updateTotalParticipants();

        // Remove or comment out the duplicate event listener block
        // Remove this block if present:
        /*
        document.getElementById('submitBtn').addEventListener('click', async function(e) {
            e.preventDefault();
            console.log("Register button clicked");
            // ...code...
        });
        */

        // The inline onclick handler calls submitRegistration(), which is defined below.
    });

    async function submitRegistration() {
        const submitBtn = document.querySelector('button[type="submit"]');
        
        try {
            submitBtn.classList.add('loading');
            console.log("Starting spot registration submission");

            // Validate form
            if (selectedEvents.length === 0) {
                alert('Please select at least one event');
                submitBtn.classList.remove('loading');
                return;
            }

            const college = document.getElementById('college').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const utrNumber = document.getElementById('utr-number').value;

            if (!college || !email || !phone || !utrNumber) {
                alert('Please fill in all required fields including UTR number');
                submitBtn.classList.remove('loading');
                return;
            }

            const formData = {
                college: college,
                email: email,
                phone: phone,
                utrNumber: utrNumber,
                selectedEvents: selectedEvents,
                totalParticipants: parseInt(document.getElementById('overallParticipants').textContent),
                totalCost: parseFloat(document.querySelector('.total-cost').textContent.replace('Total Cost: ₹', ''))
            };

            console.log("Sending spot registration data:", formData);

            // Use the correct endpoint for spot registration
            const response = await fetch('/spot-register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });

            console.log("Server response status:", response.status);
            
            const data = await response.json();
            console.log("Server response data:", data);

            if (data.success) {
                window.location.href = `/spot-acknowledgement/${data.ack_id}`;
            } else {
                throw new Error(data.message || 'Registration failed');
            }
        } catch (error) {
            console.error("Registration error details:", error);
            alert(`Registration failed: ${error.message}`);
            submitBtn.classList.remove('loading');
        }
    }

    // Update group size input validation
    groupSizeInput.addEventListener("input", function() {
        if (!currentEventSelection || currentEventSelection.type !== "team") return;
        
        let value = parseInt(this.value);
        const min = currentEventSelection.minTeam;
        const max = currentEventSelection.maxTeam;
        
        // Don't auto-adjust the value, just validate
        if (value >= min && value <= max) {
            groupSizeError.textContent = "";
            groupSizeError.classList.add("hidden");
            addEventBtn.disabled = false;
            generateMemberInputs(value);
        } else {
            groupSizeError.textContent = `Please enter a value between ${min} and ${max}`;
            groupSizeError.classList.remove("hidden");
            addEventBtn.disabled = true;
        }
    });

    // Update member inputs generation function
    function generateMemberInputs(count) {
        if (!currentEventSelection || currentEventSelection.type !== "team") return;
        
        memberInputsContainer.innerHTML = '';
        teamMembersContainer.classList.remove("hidden");
        
        // Use the actual count without clamping
        for (let i = 1; i <= count; i++) {
            const memberDiv = document.createElement("div");
            memberDiv.className = "member-input";
            
            const memberInput = document.createElement("input");
            memberInput.type = "text";
            memberInput.id = `member-${i}`;
            memberInput.name = `member-${i}`;
            memberInput.placeholder = `Member ${i} Name`;
            memberInput.className = "w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white \
                                   placeholder:text-gray-400 outline-none transition-all duration-300 \
                                   focus:border-[#FF00FF] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]";
            
            memberDiv.appendChild(memberInput);
            memberInputsContainer.appendChild(memberDiv);
        }
    }

    // Modify the individual participant container HTML section
    function updateIndividualParticipantContainer() {
        const individualParticipantContainer = document.getElementById('individual-participant-container');
        individualParticipantContainer.innerHTML = `
            <label class="block text-[#00FFFF] mb-2 font-['Orbitron']">Participant Details</label>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <input type="text" 
                           id="individual-participant" 
                           class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                  placeholder:text-gray-400 outline-none transition-all duration-300
                                  focus:border-[#FF00FF] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]"
                           placeholder="Enter Name">
                </div>
                <div>
                    <input type="text" 
                           id="individual-usn" 
                           class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                  placeholder:text-gray-400 outline-none transition-all duration-300
                                  focus:border-[#FF00FF] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]"
                           placeholder="Enter USN/College ID">
                </div>
            </div>
        `;
    }
</script>

<!-- Add these enhanced styles for event options -->
<style>
.event-option {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    border-radius: 0.5rem;
    border: 2px solid #00FFFF;
    background: rgba(32,34,39,0.8);
    margin-bottom: 0.75rem;
    transition: all 0.3s ease;
}

.event-option:hover {
    border-color: #FF00FF;
    box-shadow: 0 0 15px rgba(255,0,255,0.3);
}

.event-option input[type="radio"] {
    width: 1.25rem;
    height: 1.25rem;
    accent-color: #00FFFF;
    cursor: pointer;
}

.event-option label {
    color: #C0C0C0;
    cursor: pointer;
    flex: 1;
    transition: all 0.3s ease;
}

.event-option:has(input:checked) {
    border-color: #FF00FF;
    background: rgba(255,0,255,0.1);
}

.event-option input:checked + label {
    color: #00FFFF;
}

/* Selected Events Styling */
.selected-event {
    background: rgba(32,34,39,0.8);
    padding: 1rem;
    border-radius: 0.5rem;
    border: 2px solid #00FFFF;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
    transition: all 0.3s ease;
}

.selected-event:hover {
    border-color: #FF00FF;
    box-shadow: 0 0 15px rgba(255,0,255,0.3);
}

.selected-event span {
    color: #C0C0C0;
}

.remove-event-btn {
    color: #FF00FF;
    font-size: 1.25rem;
    font-weight: bold;
    padding: 0.5rem;
    transition: all 0.3s ease;
}

.remove-event-btn:hover {
    transform: scale(1.25);
}

/* Input Field Enhancement */
.member-input input {
    width: 100%;
    padding: 0.75rem;
    background: rgba(32,34,39,0.8);
    border: 2px solid #00FFFF;
    border-radius: 0.5rem;
    color: white;
    outline: none;
    transition: all 0.3s ease;
}

.member-input input::placeholder {
    color: #9CA3AF;
}

.member-input input:focus {
    border-color: #FF00FF;
    box-shadow: 0 0 15px rgba(255,0,255,0.3);
}

/* Loading State */
.button-content {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

button.loading .button-content span {
    opacity: 0;
}

button.loading .button-content .spinner {
    position: absolute;
    display: block;
}

/* Error States */
.invalid-input {
    border-color: rgb(239, 68, 68);
    background: rgba(239, 68, 68, 0.1);
}

.error-message {
    color: rgb(239, 68, 68);
    font-size: 0.875rem;
    margin-top: 0.25rem;
}

/* Hover Effects */
.form-group:hover label {
    color: #FF00FF;
    transition: color 0.3s ease;
}

/* Group Size Container Enhancement */
#group-size-container input[type="number"] {
    -webkit-appearance: none;
    -moz-appearance: textfield;
    appearance: none; /* Add standard property */
}

#group-size-container input[type="number"]::-webkit-outer-spin-button,
#group-size-container input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none; /* Add standard property */
    margin: 0;
}

/* Event Selection Inputs */
select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none; /* Add standard property */
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2300FFFF' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 0.7rem center;
    background-size: 1em;
    padding-right: 2.5rem;
}

/* Radio Buttons */
input[type="radio"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none; /* Add standard property */
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid #00FFFF;
    border-radius: 50%;
    outline: none;
    cursor: pointer;
    transition: all 0.3s ease;
}

input[type="radio"]:checked {
    background-color: #00FFFF;
    box-shadow: 0 0 10px rgba(0,255,255,0.5);
    border-color: #FF00FF;
}

/* Container Animations */
.selected-events-section,
.personal-details-section {
    transform: translateY(0);
    transition: all 0.5s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.selected-events-section:not(.hidden),
.personal-details-section:not(.hidden) {
    animation: fadeIn 0.5s ease forwards;
}

/* Cost Display Enhancement */
.total-cost {
    position: relative;
    font-size: 1.875rem;
    font-weight: bold;
    color: #00FFFF;
}

.total-cost::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(to right, #6D28D9, #3B82F6, #00FFFF);
}

/* Responsive Adjustments */
@media (max-width: 640px) {
    .event-option {
        padding: 0.75rem;
    }
    
    .selected-event {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .remove-event-btn {
        align-self: flex-end;
    }
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 0.5rem;
}

::-webkit-scrollbar-track {
    background: rgba(32,34,39,0.8);
}

::-webkit-scrollbar-thumb {
    background: #00FFFF;
    border-radius: 9999px;
}

::-webkit-scrollbar-thumb:hover {
    background: #FF00FF;
    transition: background-color 0.3s ease;
}

/* ...existing styles... */

#group-size {
    -moz-appearance: textfield;
    cursor: default;
}

#group-size::-webkit-outer-spin-button,
#group-size::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

#decrease-size:not(:disabled):hover,
#increase-size:not(:disabled):hover {
    transform: scale(1.1);
}

#decrease-size:disabled,
#increase-size:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
</style>

{% endblock %}
